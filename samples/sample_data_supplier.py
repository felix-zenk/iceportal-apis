from datetime import datetime, timedelta

# Hamburg -> München
status = { 'connection': True, 'servicelevel': 'AVAILABLE_SERVICE', 'internet': 'HIGH', 'speed': 169, 'gpsStatus': 'VALID', 'tzn': 'Tz1191', 'series': '011', 'latitude': 52.766562, 'longitude': 10.251847, 'serverTime': 1603913237508, 'wagonClass': 'SECOND', 'navigationChange': '2020-10-28-04-01-05', 'trainType': 'ICE' }
trip = {'trip': {'tripDate': '2020-10-31', 'trainType': 'ICE', 'vzn': '881', 'actualPosition': 159781, 'distanceFromLastStop': 41632, 'totalDistance': 708799, 'stopInfo': {'scheduledNext': '8002548_00', 'actualNext': '8002548_00', 'actualLast': '8002553_00', 'actualLastStarted': '8002553', 'finalStationName': 'München Hbf', 'finalStationEvaNr': '8000261_00'}, 'stops': [{'station': {'evaNr': '8002553_00', 'name': 'Hamburg-Altona', 'code': None, 'geocoordinates': {'latitude': 53.552695, 'longitude': 9.935175}}, 'timetable': {'scheduledArrivalTime': None, 'actualArrivalTime': None, 'showActualArrivalTime': None, 'arrivalDelay': '', 'scheduledDepartureTime': 1604148180000, 'actualDepartureTime': 1604148180000, 'showActualDepartureTime': True, 'departureDelay': ''}, 'track': {'scheduled': '11', 'actual': '11'}, 'info': {'status': 0, 'passed': True, 'positionStatus': 'passed', 'distance': 0, 'distanceFromStart': 0}, 'delayReasons': None}, {'station': {'evaNr': '8002548_00', 'name': 'Hamburg Dammtor', 'code': None, 'geocoordinates': {'latitude': 53.560751, 'longitude': 9.989566}}, 'timetable': {'scheduledArrivalTime': 1604148720000, 'actualArrivalTime': 1604148840000, 'showActualArrivalTime': True, 'arrivalDelay': '+2', 'scheduledDepartureTime': 1604148780000, 'actualDepartureTime': 1604148900000, 'showActualDepartureTime': True, 'departureDelay': '+2'}, 'track': {'scheduled': '4', 'actual': '4'}, 'info': {'status': 0, 'passed': True, 'positionStatus': 'passed', 'distance': 3704, 'distanceFromStart': 3704}, 'delayReasons': None}, {'station': {'evaNr': '8002549_00', 'name': 'Hamburg Hbf', 'code': None, 'geocoordinates': {'latitude': 53.552736, 'longitude': 10.006909}}, 'timetable': {'scheduledArrivalTime': 1604149080000, 'actualArrivalTime': 1604149140000, 'showActualArrivalTime': True, 'arrivalDelay': '+1', 'scheduledDepartureTime': 1604149260000, 'actualDepartureTime': 1604149260000, 'showActualDepartureTime': True, 'departureDelay': ''}, 'track': {'scheduled': '14', 'actual': '14'}, 'info': {'status': 0, 'passed': True, 'positionStatus': 'passed', 'distance': 1452, 'distanceFromStart': 5156}, 'delayReasons': None}, {'station': {'evaNr': '8000147_00', 'name': 'Hamburg-Harburg', 'code': None, 'geocoordinates': {'latitude': 53.455908, 'longitude': 9.991701}}, 'timetable': {'scheduledArrivalTime': 1604149800000, 'actualArrivalTime': 1604149980000, 'showActualArrivalTime': True, 'arrivalDelay': '+3', 'scheduledDepartureTime': 1604149920000, 'actualDepartureTime': 1604150100000, 'showActualDepartureTime': True, 'departureDelay': '+3'}, 'track': {'scheduled': '4', 'actual': '4'}, 'info': {'status': 0, 'passed': True, 'positionStatus': 'passed', 'distance': 10817, 'distanceFromStart': 15973}, 'delayReasons': None}, {'station': {'evaNr': '8000238_00', 'name': 'Lüneburg', 'code': None, 'geocoordinates': {'latitude': 53.249656, 'longitude': 10.41989}}, 'timetable': {'scheduledArrivalTime': 1604150820000, 'actualArrivalTime': 1604151060000, 'showActualArrivalTime': True, 'arrivalDelay': '+4', 'scheduledDepartureTime': 1604150940000, 'actualDepartureTime': 1604151240000, 'showActualDepartureTime': True, 'departureDelay': '+5'}, 'track': {'scheduled': '1', 'actual': '1'}, 'info': {'status': 0, 'passed': True, 'positionStatus': 'passed', 'distance': 36529, 'distanceFromStart': 52502}, 'delayReasons': None}, {'station': {'evaNr': '8000152_00', 'name': 'Hannover Hbf', 'code': None, 'geocoordinates': {'latitude': 52.376761, 'longitude': 9.741021}}, 'timetable': {'scheduledArrivalTime': 1604154120000, 'actualArrivalTime': 1604154120000, 'showActualArrivalTime': True, 'arrivalDelay': '', 'scheduledDepartureTime': 1604154360000, 'actualDepartureTime': 1604154360000, 'showActualDepartureTime': True, 'departureDelay': ''}, 'track': {'scheduled': '3', 'actual': '3'}, 'info': {'status': 0, 'passed': True, 'positionStatus': 'departed', 'distance': 107279, 'distanceFromStart': 159781}, 'delayReasons': [{'code':'38', 'text':'Technische Störung an der Strecke'}]}, {'station': {'evaNr': '8000128_00', 'name': 'Göttingen', 'code': None, 'geocoordinates': {'latitude': 51.536815, 'longitude': 9.926072}}, 'timetable': {'scheduledArrivalTime': 1604156400000, 'actualArrivalTime': 1604156400000, 'showActualArrivalTime': True, 'arrivalDelay': '', 'scheduledDepartureTime': 1604156520000, 'actualDepartureTime': 1604156520000, 'showActualDepartureTime': True, 'departureDelay': ''}, 'track': {'scheduled': '10', 'actual': '10'}, 'info': {'status': 0, 'passed': False, 'positionStatus': 'future', 'distance': 94281, 'distanceFromStart': 254062}, 'delayReasons': None}, {'station': {'evaNr': '8003200_00', 'name': 'Kassel-Wilhelmshöhe', 'code': None, 'geocoordinates': {'latitude': 51.313114, 'longitude': 9.446898}}, 'timetable': {'scheduledArrivalTime': 1604157660000, 'actualArrivalTime': 1604157660000, 'showActualArrivalTime': True, 'arrivalDelay': '', 'scheduledDepartureTime': 1604157780000, 'actualDepartureTime': 1604157900000, 'showActualDepartureTime': True, 'departureDelay': '+2'}, 'track': {'scheduled': '2', 'actual': '2'}, 'info': {'status': 0, 'passed': False, 'positionStatus': 'future', 'distance': 41515, 'distanceFromStart': 295577}, 'delayReasons': None}, {'station': {'evaNr': '8000115_00', 'name': 'Fulda', 'code': None, 'geocoordinates': {'latitude': 50.554723, 'longitude': 9.683977}}, 'timetable': {'scheduledArrivalTime': 1604159640000, 'actualArrivalTime': 1604159640000, 'showActualArrivalTime': True, 'arrivalDelay': '', 'scheduledDepartureTime': 1604159760000, 'actualDepartureTime': 1604159760000, 'showActualDepartureTime': True, 'departureDelay': ''}, 'track': {'scheduled': '4', 'actual': '4'}, 'info': {'status': 0, 'passed': False, 'positionStatus': 'future', 'distance': 85974, 'distanceFromStart': 381551}, 'delayReasons': None}, {'station': {'evaNr': '8000260_00', 'name': 'Würzburg Hbf', 'code': None, 'geocoordinates': {'latitude': 49.801796, 'longitude': 9.93578}}, 'timetable': {'scheduledArrivalTime': 1604161740000, 'actualArrivalTime': 1604161740000, 'showActualArrivalTime': True, 'arrivalDelay': '', 'scheduledDepartureTime': 1604161860000, 'actualDepartureTime': 1604161860000, 'showActualDepartureTime': True, 'departureDelay': ''}, 'track': {'scheduled': '4', 'actual': '4'}, 'info': {'status': 0, 'passed': False, 'positionStatus': 'future', 'distance': 85644, 'distanceFromStart': 467195}, 'delayReasons': None}, {'station': {'evaNr': '8000284_00', 'name': 'Nürnberg Hbf', 'code': None, 'geocoordinates': {'latitude': 49.445616, 'longitude': 11.082989}}, 'timetable': {'scheduledArrivalTime': 1604165040000, 'actualArrivalTime': 1604165040000, 'showActualArrivalTime': True, 'arrivalDelay': '', 'scheduledDepartureTime': 1604165220000, 'actualDepartureTime': 1604165340000, 'showActualDepartureTime': True, 'departureDelay': '+2'}, 'track': {'scheduled': '8', 'actual': '8'}, 'info': {'status': 0, 'passed': False, 'positionStatus': 'future', 'distance': 91662, 'distanceFromStart': 558857}, 'delayReasons': None}, {'station': {'evaNr': '8000183_00', 'name': 'Ingolstadt Hbf', 'code': None, 'geocoordinates': {'latitude': 48.744541, 'longitude': 11.437337}}, 'timetable': {'scheduledArrivalTime': 1604167080000, 'actualArrivalTime': 1604167080000, 'showActualArrivalTime': True, 'arrivalDelay': '', 'scheduledDepartureTime': 1604167260000, 'actualDepartureTime': 1604167260000, 'showActualDepartureTime': True, 'departureDelay': ''}, 'track': {'scheduled': '3', 'actual': '3'}, 'info': {'status': 0, 'passed': False, 'positionStatus': 'future', 'distance': 82137, 'distanceFromStart': 640994}, 'delayReasons': None}, {'station': {'evaNr': '8000261_00', 'name': 'München Hbf', 'code': None, 'geocoordinates': {'latitude': 48.140232, 'longitude': 11.558335}}, 'timetable': {'scheduledArrivalTime': 1604169720000, 'actualArrivalTime': 1604169720000, 'showActualArrivalTime': True, 'arrivalDelay': '', 'scheduledDepartureTime': None, 'actualDepartureTime': None, 'showActualDepartureTime': None, 'departureDelay': ''}, 'track': {'scheduled': '18', 'actual': '18'}, 'info': {'status': 0, 'passed': False, 'positionStatus': 'future', 'distance': 67805, 'distanceFromStart': 708799}, 'delayReasons': None}]}, 'connection': None, 'selectedRoute': {'conflictInfo': {'status': 'NO_CONFLICT', 'text': None}, 'mobility': None}, 'active': None}

def get_sample_data_status():
    return status

def get_sample_data_trip():
    return trip

def refresh_data():
    timestamps = []
    for stop in get_sample_data_trip()['trip']['stops']:
        try:
            timestamps.append(int(str(stop['timetable']['actualArrivalTime'])[0:10]))
        except ValueError:
            timestamps.append(None)
        try:
            timestamps.append(int(str(stop['timetable']['actualDepartureTime'])[0:10]))
        except ValueError:
            timestamps.append(None)

    first_time = None
    timestamp_now = int(datetime.now().timestamp())+60
    deltas_from_start = []

    for t in timestamps:
        if t != None and first_time == None:
            first_time = t
            deltas_from_start.append(timestamp_now)
        elif t != None:
            deltas_from_start.append(t-first_time+timestamp_now)
        else:
            deltas_from_start.append(None)
    
    pointer = 0
    for stop in trip['trip']['stops']:
        stop['timetable']['actualArrivalTime'] = deltas_from_start[pointer]
        stop['timetable']['actualDepartureTime'] = deltas_from_start[pointer+1]
        pointer+=2
